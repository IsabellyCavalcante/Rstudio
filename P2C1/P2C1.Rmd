---
title: "Pro2CP1 - Revisitando uma visualização sua"
date: "18 de abril de 2017"
output: html_notebook
---

## Visão geral

Esta atividade faz parte da disciplina de Fundamentos de Pesquisa em Ciência da Computação II da Pós-Graduação em Ciência da Computação na Universidade Federal de Campina Grande. Nosso objetivo nesta atividade é:

1) Praticar a crítica e concepção de visualizações
2) Explorar o processo de gerar figuras profissionais e prontas para a publicação

## Atividade

A visualização que escolhi para refazer foi baseada em uma resposta de uma atividade passada minha referente a distribuição das porcentagens de passagens gastas com pessoas que não fossem o próprio deputado.


```{r}
library(readr)
library(dplyr, warn.conflicts = F)
library(ggplot2)

gastos <- read_csv("~/Dados_FPCC2/gastos-cota_atividade_parlamentar.csv")

dep_detalhes <- read.csv("~/Dados_FPCC2/deputados-detalhes.csv")
```

```{r}
gastos_filtrados = gastos %>%
  select(ideCadastro, numAno, numMes, txtDescricao, vlrLiquido, txtPassageiro, txNomeParlamentar)

dep_filtrados = dep_detalhes %>%
  select(sexo, ideCadastro)

dados_finais <- merge(gastos_filtrados, dep_filtrados, by = "ideCadastro")

gastos_aviao = dados_finais %>% 
  filter(txtDescricao == "Emissão Bilhete Aéreo" | txtDescricao == "PASSAGENS AÉREAS")

```

O próximo passo foi o mais complicado de fazer, pois ele representa uma função que dada um ano, os 3 meses de um trimestre e um conjunto de dados ele irá retornar a porcentagem de passagens gasta com outras pessoas por deputado nesse trimestre desse ano. Além de ter também o sexo do respectivo deputado.

```{r}
porcentagens_por_trimestre <- function(mes1, mes2, mes3, ano, dados){
  dados = dados %>%
    filter(numAno == ano) %>%
    filter(numMes == mes1 | numMes == mes2 | numMes == mes3)
  
  passagens_nao_pessoais = dados %>%
    filter(txtPassageiro != txNomeParlamentar) %>%
    group_by(txNomeParlamentar, ideCadastro) %>%
    summarise(outros = n()) %>%
    arrange(txNomeParlamentar)
  
  passagens_pessoais = dados %>%
    filter(txtPassageiro == txNomeParlamentar) %>%
    group_by(txNomeParlamentar, ideCadastro) %>%
    summarise(proprio = n()) %>%
    arrange(txNomeParlamentar)
  
  passagens_total = merge(passagens_nao_pessoais, passagens_pessoais, by = "txNomeParlamentar", all = TRUE) %>%
    arrange(txNomeParlamentar)

  passagens_total[is.na(passagens_total)] <- 0

  passagens_total$ideCadastro.y <- with(passagens_total, 
                                        ifelse(ideCadastro.y == 0, ideCadastro.x, ideCadastro.y))

  passagens_total$total = passagens_total$proprio + passagens_total$outros

  passagens_total$porcentagem_outros = passagens_total$outros / passagens_total$total

  passagens_total = passagens_total %>%
    select(ideCadastro.y, porcentagem_outros)

  dados_trimestre_final = merge(dados, passagens_total, by.x = "ideCadastro", by.y = "ideCadastro.y") %>%
    group_by(ideCadastro, sexo, porcentagem_outros) %>%
    summarise(linhas = n())
  
  return (dados_trimestre_final)
}
```

```{r}
# Dados dos trimestres de 2015
despesas_15_t1 = porcentagens_por_trimestre(1, 2, 3, 2015, gastos_aviao) %>%
  select(-linhas)
despesas_15_t1$ano = 2015
despesas_15_t1$trimestre = "T1"

despesas_15_t2 = porcentagens_por_trimestre(4, 5, 6, 2015, gastos_aviao) %>%
  select(-linhas)
despesas_15_t2$ano = 2015
despesas_15_t2$trimestre = "T2"

despesas_15_t3 = porcentagens_por_trimestre(7, 8, 9, 2015, gastos_aviao) %>%
  select(-linhas)
despesas_15_t3$ano = 2015
despesas_15_t3$trimestre = "T3"

despesas_15_t4 = porcentagens_por_trimestre(10, 11, 12, 2015, gastos_aviao) %>%
  select(-linhas)
despesas_15_t4$ano = 2015
despesas_15_t4$trimestre = "T4"

# Dados dos trimestres de 2016
despesas_16_t1 = porcentagens_por_trimestre(1, 2, 3, 2016, gastos_aviao) %>%
  select(-linhas)
despesas_16_t1$ano = 2016
despesas_16_t1$trimestre = "T1"

despesas_16_t2 = porcentagens_por_trimestre(4, 5, 6, 2016, gastos_aviao) %>%
  select(-linhas)
despesas_16_t2$ano = 2016
despesas_16_t2$trimestre = "T2"

despesas_16_t3 = porcentagens_por_trimestre(7, 8, 9, 2016, gastos_aviao) %>%
  select(-linhas)
despesas_16_t3$ano = 2016
despesas_16_t3$trimestre = "T3"

despesas_16_t4 = porcentagens_por_trimestre(10, 11, 12, 2016, gastos_aviao) %>%
  select(-linhas)
despesas_16_t4$ano = 2016
despesas_16_t4$trimestre = "T4"

```

```{r}
ggplot(gastos_15_aviao, aes(x= txtDescricao, y=vlrLiquido)) + 
  geom_violin() +
  labs(x='Tipo da Despesa', y='Valor Líquido')
```


